<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MySQL/MariaDB UPDATE/DELETE Statement Issue - Mion's Dev Log</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=Syne:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-deep: #0d0d0d;
            --bg-dark: #1a1a1a;
            --bg-card: #1f1f1f;
            --accent-purple: #a78bfa;
            --accent-blue: #60a5fa;
            --accent-green: #34d399;
            --text-primary: #f5f5f5;
            --text-secondary: #a1a1aa;
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'IBM Plex Mono', monospace;
            background: var(--bg-deep);
            color: var(--text-primary);
            line-height: 1.8;
        }

        /* í—¤ë” */
        .header {
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .back-btn {
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.9rem;
            transition: color 0.3s ease;
        }

        .back-btn:hover {
            color: var(--accent-purple);
        }

        .header-title {
            font-family: 'Syne', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }

        /* ê¸€ ë©”íƒ€ ì •ë³´ */
        .post-meta {
            margin-bottom: 3rem;
        }

        .post-date {
            font-size: 0.85rem;
            color: var(--text-secondary);
            letter-spacing: 1px;
            margin-bottom: 1rem;
        }

        .post-title {
            font-family: 'Syne', sans-serif;
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 800;
            line-height: 1.2;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--text-primary), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            padding: 0.4rem 1rem;
            background: rgba(167, 139, 250, 0.1);
            border: 1px solid rgba(167, 139, 250, 0.3);
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--accent-purple);
        }

        /* ê¸€ ë‚´ìš© */
        .post-content {
            font-size: 1rem;
            line-height: 1.9;
        }

        .post-content p {
            margin-bottom: 1.5rem;
            color: var(--text-secondary);
        }

        .post-content h2 {
            font-family: 'Syne', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
            color: var(--text-primary);
        }

        .post-content h3 {
            font-family: 'Syne', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
            color: var(--accent-blue);
        }

        .post-content a {
            color: var(--accent-purple);
            text-decoration: none;
            border-bottom: 1px solid var(--accent-purple);
            transition: all 0.3s ease;
        }

        .post-content a:hover {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
        }

        .post-content ul {
            list-style: none;
            margin: 1.5rem 0;
        }

        .post-content ul li {
            padding-left: 1.5rem;
            margin-bottom: 0.8rem;
            position: relative;
            color: var(--text-secondary);
        }

        .post-content ul li::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--accent-green);
        }

        .post-content code {
            background: rgba(167, 139, 250, 0.1);
            border: 1px solid rgba(167, 139, 250, 0.2);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.9rem;
            color: var(--accent-purple);
        }

        .post-content pre {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
            overflow-x: auto;
            position: relative;
        }

        .post-content pre code {
            background: none;
            border: none;
            padding: 0;
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* SQL ì½”ë“œ í•˜ì´ë¼ì´íŒ… */
        .post-content pre code .hljs-keyword {
            color: var(--accent-purple);
            font-weight: 600;
        }

        .post-content pre code .hljs-number {
            color: var(--accent-green);
        }

        .post-content pre code .hljs-string {
            color: var(--accent-blue);
        }

        /* ì¸ìš©êµ¬ ìŠ¤íƒ€ì¼ */
        .post-content blockquote {
            background: var(--bg-card);
            border-left: 4px solid var(--accent-purple);
            padding: 1.5rem;
            margin: 2rem 0;
            border-radius: 8px;
        }

        .post-content blockquote p {
            margin-bottom: 0;
            color: var(--text-secondary);
        }

        /* ì •ë³´ ë°•ìŠ¤ */
        .info-box {
            background: rgba(96, 165, 250, 0.1);
            border: 1px solid rgba(96, 165, 250, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 2rem 0;
        }

        .info-box-title {
            font-weight: 700;
            color: var(--accent-blue);
            margin-bottom: 0.5rem;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .post-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 4rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
        }

        .nav-btn {
            padding: 1rem 2rem;
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9rem;
        }

        .nav-btn:hover {
            border-color: var(--accent-purple);
            background: rgba(167, 139, 250, 0.1);
        }

        /* Footer */
        footer {
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            padding: 2rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            margin-top: 4rem;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 2rem 1.5rem;
            }

            .header-container {
                padding: 0 1.5rem;
            }

            .post-title {
                font-size: 2rem;
            }

            .post-content h2 {
                font-size: 1.5rem;
            }

            .post-content h3 {
                font-size: 1.2rem;
            }

            .post-nav {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-container">
            <a href="index.html#devlog" class="back-btn">â† ëª©ë¡ìœ¼ë¡œ</a>
            <div class="header-title">Dev Log</div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <main class="container">
        <!-- ê¸€ ë©”íƒ€ ì •ë³´ -->
        <div class="post-meta">
            <div class="post-date">2025.01.20</div>
            <h1 class="post-title">MySQL/MariaDB UPDATE/DELETE Statement Issue with Subqueries</h1>
            <div class="post-tags">
                <span class="tag">Hibernate ORM</span>
                <span class="tag">MySQL</span>
                <span class="tag">MariaDB</span>
                <span class="tag">Subquery</span>
                <span class="tag">Open Source</span>
            </div>
        </div>

        <!-- ê¸€ ë‚´ìš© -->
        <article class="post-content">
            <p>ìµœê·¼ ì„œë¸Œì¿¼ë¦¬ì— ëŒ€í•´ ë” ì•Œì•„ë³´ê³  ì‹¶ì–´ Hibernate-ORM ì´ìŠˆë¥¼ íƒìƒ‰í•˜ë˜ ì¤‘ ì•Œë§ì€ ì´ìŠˆê°€ ìˆì–´ ê¸°ì—¬ë¥¼ í•˜ê¸°ë¡œ í–ˆë‹¤.</p>

            <p>
                <a href="https://hibernate.atlassian.net/browse/HHH-18040" target="_blank">ISSUE: HHH-18040</a>
            </p>

            <p>ì´ìŠˆë¥¼ ë¶„ì„í•˜ë©° MERGEë˜ê¸° ê¹Œì§€ì˜ íšŒê³  ê¸€(<a href="https://www.linkedin.com/feed/update/urn:li:activity:7414946017055453184/" target="_blank">1093ì—ëŸ¬ í•´ê²°</a>)ì´ë‹¤.</p>

            <p>ë¬¸ì œëŠ” MERGEëœ í›„ ë©”ì¸í…Œì´ë„ˆê°€ ì•„ë˜ì™€ ê°™ì´ ëŒ“ê¸€ì„ ë‹¬ì•˜ë‹¤.</p>

            <blockquote>
                <p>Hey @Mion, I just noticed that the MySQLDmlSubqueryTest also runs on MariaDB and before version 11.1 a self-join rewrite optimization wasn't implemented yet, which results in the same error as on MySQL before. Would you please be so kind and look into this matter? I applied the same code change (double nesting) you did for MySQL, but unfortunately correlations don't work.</p>
                <p>I'll just skip the failing tests for now, but ideally, you would find a way to make correlations works ğŸ™‚</p>
            </blockquote>

            <p><code>correlation</code>ì´ ë¬¸ì œë‹¤.</p>

            <p>ë‹¹ì—°íˆ MYSQLì„ ìˆ˜ì •í•˜ê¸°ì— MARIADBì—ë„ ì˜í–¥ì´ ê°€ëŠ”ì¤„ì€ ì•Œì•˜ì§€ë§Œ í™•ì¸í•œ ë°” MARIADBì—ì„œëŠ” MYSQLê³¼ ê°™ì€ ì¿¼ë¦¬ë¥¼ ì‘ì„±í–ˆì„ë•Œ 1093ì—ëŸ¬ê°€ ë°œìƒí•˜ì§€ ì•Šì•˜ë‹¤. ê·¸ ì´ìœ ë¥¼ ì°¾ì•„ë³´ë‹ˆ ì´ë¯¸ 11.1ë²„ì „ì´ìƒì—ì„œëŠ” "referring to a table in a subquery which is the target for a delete/update" ì´ ë¬¸ì œë¥¼ í•´ê²°(<a href="https://jira.mariadb.org/browse/MDEV-7487" target="_blank">MDEV-7487</a>)í•˜ê³  ìˆì—ˆë‹¤.</p>

            <p>ë¬¸ì œëŠ” Hibernate-ORMì˜ MARIADB ìµœì†Œ ì§€ì› ë²„ì „ì€ 10.6 ì´ì˜€ìœ¼ë©° ê³§ ì§€ì›ì¢…ë£Œê°€ ë˜ì§€ë§Œ ì´í›„ 10.11ë²„ì „ì€ ì—¬ì „íˆ ì´í›„ì—ë„ ìœ íš¨í•˜ê¸°ì— 11.1 ë²„ì „ ì´ì „ì—ì„œì˜ í•´ë‹¹ ì´ìŠˆë¥¼ ìˆ˜ì •í•´ì•¼í–ˆë‹¤.</p>

            <p>ë”°ë¼ì„œ ë‚˜ëŠ” ë©”ì¸í…Œì´ë„ˆì˜ ìš”êµ¬ëŒ€ë¡œ ì–´ë–»ê²Œ í•˜ë©´ 11.1ì´ì „ì˜ ë²„ì „ì—ì„œ í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í• ê¹Œ ê³ ë¯¼ì„ í•˜ì˜€ê³  ì—¬ëŸ¬ê°€ì§€ ë¬¸ì„œë¥¼ ì°¾ëŠ” ì¤‘ ì´ë¯¸ MARIADB 10.3ë¶€í„° ìê¸° ì°¸ì¡°(<a href="https://ctventures.com/whats-new-in-mariadb-10-3/" target="_blank">What's New in MariaDB 10.3</a>)ê°€ ê°€ëŠ¥í–ˆë˜ ê²ƒì´ì˜€ë‹¤.</p>

            <p>ì¼ë‹¨ mysqlì—ì„œ ì‚¬ìš©í•œ select * fromë¬¸ìœ¼ë¡œ í•œë²ˆ ë” ê°ì‹¸ëŠ” ê²ƒì€ mariadbì—ì„œ ë¶ˆê°€ëŠ¥í•˜ë‹¤. ì™œëƒí•˜ë©´ mysqlì€ correlationì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šì§€ë§Œ mariadbëŠ” 2ë‹¨ê³„ ì„œë¸Œì¿¼ë¦¬ depthë©´ correlationì—ëŸ¬ê°€ ë‚˜ê¸° ë•Œë¬¸ì´ë‹¤. mysqlì€ LATERALì„ ì§€ì›í•˜ê¸°ì— ì—ëŸ¬ê°€ ë‚˜ì§€ ì•ŠëŠ”ê²ƒ ê°™ë‹¤. ì–´ì¨‹ë“  ê·¸ë ‡ê¸°ì— ê°ì‹¸ëŠ” ë°©ë²•ì´ ì•„ë‹Œ 3ê°€ì§€ ë°©ë²•ì„ ì°¾ì•˜ë‹¤.</p>

            <h2>í•´ê²° ë°©ë²• íƒìƒ‰</h2>

            <h3>11.1+ ë²„ì „ ì—ë®¬ë ˆì´ì…˜</h3>
            <p>ê²°ë¡ ì ìœ¼ë¡œ ì´ê±´ exist, inì€ semi joinì„ í†µí•´ ë¹„êµì  ì‰½ê²Œ êµ¬í˜„í•  ìˆ˜ ìˆì—ˆì§€ë§Œ ë‚˜ë¨¸ì§€ ì¼€ì´ìŠ¤(any, all, scalar ë“±)ì—ì„œëŠ” ë„ˆë¬´ í° ë³µì¡ë„ë¥¼ ê°€ì ¸ ì˜¤íˆë ¤ êµ¬í˜„í›„ ì½”ë“œì˜ ë³µì¡ë„ì™€ ìœ ì§€ë³´ìˆ˜ì„±ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆë‹¤ê³  ìƒê°í–ˆë‹¤.</p>

            <p>ê·¸ë ‡ë‹¤ë©´ ëª¨ë“  ì¼€ì´ìŠ¤ì— ì ìš©í•  ìˆ˜ ìˆëŠ” í˜„ì‹¤ì ì¸ ë°©ì•ˆì€ ë¬´ì—‡ì¼ê¹Œ?</p>

            <h3>ì„œë¸Œì¿¼ë¦¬ í…Œì´ë¸” ê°ì‹¸ê¸° (Derived Table)</h3>
            <p>ì¼ë‹¨ ì´ê²ƒë„ ê²°ë¡ ì ìœ¼ë¡œ ì ìš©ì‹œí‚¤ì§€ ì•Šì€ ì´ìœ ëŠ” derived table ì „ì²´ ë¬¼ë¦¬í™”(materialization) ë°œìƒí•˜ì—¬ ëŒ€ìš©ëŸ‰ í…Œì´ë¸”ì—ì„œ ì„±ëŠ¥ ì €í•˜ê°€ ì¼ì–´ë‚  ê°€ëŠ¥ì„±ì´ ìˆê¸° ë•Œë¬¸ì´ë‹¤.</p>

            <h3>Single-table DELETE / UPDATE ë¬¸ë²• ì‚¬ìš© (ë©”ì¸í…Œì´ë„ˆ ìŠ¹ì¸)</h3>
            <p>ë‚´ê°€ ì œì•ˆí•œ í•´ê²°ì±… 2ê°€ì§€ì¤‘ ë°›ì•„ë“¤ì—¬ì§„ ë°©ë²•ì´ë‹¤.</p>

            <p>MariaDBì˜ ì œì•½ì€ multi-table DELETE/UPDATE ë¬¸ë²•ì— ê°•í•˜ê²Œ ê±¸ë ¤ ìˆë‹¤. ë°˜ë©´, single-table DELETE ì—ì„œëŠ” alias ì—†ì´ í…Œì´ë¸”ëª…ì„ ì§ì ‘ ì‚¬ìš©í•˜ë©´ correlated subqueryê°€ í—ˆìš©ëœë‹¤.</p>

            <h3>ê¸°ì¡´ (ì—ëŸ¬ ë°œìƒ)</h3>
            <pre><code class="lang-sql"><span class="hljs-keyword">DELETE</span> e
<span class="hljs-keyword">FROM</span> EntityOfBasics e 
<span class="hljs-keyword">WHERE EXISTS</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">FROM</span> EntityOfBasics e2
    <span class="hljs-keyword">WHERE</span> e2.theInteger > e.theInteger
);</code></pre>

            <h3>ìˆ˜ì • í›„ (MariaDB 10.xì—ì„œ ì •ìƒ ë™ì‘)</h3>
            <pre><code class="lang-sql"><span class="hljs-keyword">DELETE FROM</span> EntityOfBasics
<span class="hljs-keyword">WHERE EXISTS</span> (
    <span class="hljs-keyword">SELECT</span> <span class="hljs-number">1</span>
    <span class="hljs-keyword">FROM</span> EntityOfBasics e2
    <span class="hljs-keyword">WHERE</span> e2.theInteger > EntityOfBasics.theInteger
);</code></pre>

            <h3>ì™œ ì´ ë°©ì‹ì€ ë˜ëŠ”ê°€?</h3>
            <ul>
                <li>single-table DELETE ë¬¸ë²• ì‚¬ìš©</li>
                <li>DELETE ëŒ€ìƒ í…Œì´ë¸”ì— alias ì‚¬ìš© ì•ˆ í•¨</li>
                <li>í…Œì´ë¸”ëª…ìœ¼ë¡œ ì§ì ‘ ìƒê´€ ì°¸ì¡°</li>
                <li>MariaDB 10.xì—ì„œ ì™„ì „íˆ ì§€ì›ë˜ëŠ” ë¬¸ë²•</li>
            </ul>

            <div class="info-box">
                <div class="info-box-title">êµ¬í˜„ ë°©ë²•</div>
                <p>êµ¬í˜„ì€ í¬ê²Œ ì–´ë µì§€ ì•Šì•˜ë‹¤. AST Visitor íŒ¨í„´ì´ê¸° ë•Œë¬¸ì— íŠ¹ì • ì¿¼ë¦¬ë¬¸ì— ë„ë‹¬í–ˆì„ ì‹œ ë²„ì „ì„ í™•ì¸ í›„ single-tableë¡œ ë§Œë“¤ì–´ ì£¼ë©´ ëœë‹¤.</p>
            </div>

            <pre><code>if ( getDialect().getVersion().isBefore( <span class="hljs-number">11</span>, <span class="hljs-number">1</span> )
    && statement.getFromClause().getRoots().isEmpty() )</code></pre>

            <h2>ê²°ë¡ </h2>
            <p>Hibernate ORMì˜ MariaDB 10.x ë²„ì „ì—ì„œ correlated subquery ë¬¸ì œë¥¼ single-table DELETE/UPDATE ë¬¸ë²•ìœ¼ë¡œ í•´ê²°í–ˆë‹¤. ì´ ë°©ë²•ì€ ì„±ëŠ¥ ì €í•˜ ì—†ì´ ëª¨ë“  ì¼€ì´ìŠ¤ì— ì ìš© ê°€ëŠ¥í•˜ë©°, ì½”ë“œ ë³µì¡ë„ë„ ë‚®ê²Œ ìœ ì§€í•  ìˆ˜ ìˆì—ˆë‹¤.</p>
        </article>

        <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="post-nav">
            <a href="index.html#devlog" class="nav-btn">â† ëª©ë¡ìœ¼ë¡œ</a>
            <a href="#" class="nav-btn">ë‹¤ìŒ ê¸€ â†’</a>
        </div>
    </main>

    <!-- Footer -->
    <footer>
        <p>&copy; 2026 Yunyubin (Mion). Backend Developer.</p>
    </footer>
</body>
</html>
